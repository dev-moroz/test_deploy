name: Deploy

on:
  push:
    branches:
      - master

jobs:
  deploy:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        node-version: [12.x]
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v1
        with:
          node-version: '14'
      # Setup key
      - run: set -eu
      - run: mkdir "$HOME/.ssh"
      - run: echo "${{ secrets.key }}" > "$HOME/.ssh/key"
      - run: chmod 600 "$HOME/.ssh/key"
      #- run:  mkdir "$HOME/.ssh"
      #- run:  id_rsa /root/.ssh/id_rsa
      #- run:  chmod 700 /root/.ssh/id_rsa
      #- run:  echo "Host github.com\n\tStrictHostKeyChecking no\n" >> /root/.ssh/config
      # Build
      - run: npm ci
      - run: npm run build
      # Deploy
      - run: cd dist && rsync -e "-----BEGIN RSA PRIVATE KEY-----
MIIJKAIBAAKCAgEAzBMyH/RdxEfLSsb+geciR6A4vEm6zbVzFtuY8Xaf22p0zh0n
+v5bUf+D2gYskaAFaaSSHGPFKSEKTTBYWYy+Qnkm7gdQK46UXHWWX7UoQl0f+8lE
HEOfShXzoiw5G9qAzfY/E1SFLpXmcaZLENUBVHbKLPINZn9yf0hIZ3t3tjwjcgdU
0Gt1Gh1WBFRolQ/yyX/MhP2ixwsBeoJ9qhf9KdEYGj4nDPxAUBGSCu+XsCNzulMR
CVDJZCtHlssxlxmRCoMfc2GP5ZoETQ/tLCxNrHwrd+TIV6HCbBLzUZXQ8WcB5A2K
zwqJuqLv0diq73H3qq5lBIYBpe5JYCdtL9XietICov+J3ZOG9b2wqP9jyQQdgbW0
ljndlF/FOZFn3ru87OxgLqP6DNT0C98JexEXKRgOSX7QakCyxuoBnlcfaPa3v8HB
YO+KpntAHZdQcdXtZslOEEudALeRSyAh4rgKlKFrsWBhL0nChvyeKOk3hmpMGScV
rZevNeFwvB1RSYkLYoydZXminSMD3aEtIQhr66yB2giKMr3qPv7a1Uh+7emh9cA3
SKuqEplOg98C5kVLtIiBq9/+vrO/CJdtCiUoN0UOCMDn4z607WTL1UCoohhLUDp5
btwj9ZYhCSEi0lMKAWxBZXrN3Mof89tRNhrlYb8m9u5rQATPdx4lrTEUKdUCAwEA
AQKCAgArHWsboS8mRtzGYaBnpYNyioEyFomm6Ez2aVK4wQ0o+CbRXQuTVaXJfyhG
KcPEyIAcP6623MVM2TQp9qrT0I5p0NrOszDW4vqpRhaNBeMJkk8tjOoc5pSCvHyK
qLkwD0vjN8E/vj2dCAJ1xGJbngT36Vjxgfoey5JPHeBeLJGwKKh8cNwUZH+LEuOX
apXl2Ea9F4kIF+YKE2MulN8jzomoCgsDkFoDvk+AGxY1xUTQ68yJcv9Ibo794L7x
NuC1QauJAwbkA5q5MX7zIQhEqt+GL32niOhiy0QePSq28+X++npFyi6na1yJ196/
AP2sNPHUV5/0ArPacKuD6xCAaLm+RCY/hxjL0OYKY98IGoS8vHiWKEaFA91dsE5B
Bis80A3q/pP+UPNmOULONUVMZLBHJBaSVgk4/Fb/E/bLmXOUiGv7JjmWpdwcmIDB
uVNLXvaAk4OBeb4HKXLiu+t/nxn0NufoehXzab/kCi0nVocP8UeABfh5eMWVFy1v
tC/SdRATmp21ev8ILt3cg99yxDtLL1R+fJQuQjEeZYduZ02iyW+/Nk64uwMPYCQ0
o8fsNah2jtzgNSH4hivHJfqxkCZfCh65L5zAjqTid3Zl+fnUcRGwYpYeOw3punNj
1YeQ6l8Z07L8ZZREz9aIZjcK2E7XRriX3ZkeYMcYkAqZrC9zyQKCAQEA+clvB6dO" --archive --compress --delete . root@185.244.172.89:/var/www/html/deploy_test2/
